<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="./logo.png">
  <title>Open Lab Components - å¼€æºå®éªŒå™¨æç»„ä»¶åº“</title>
  <style>
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    
    :root {
      --primary: #059669;
      --primary-hover: #047857;
      --bg: #eff4ee;
      --surface: #ffffff;
      --border: #d1d5db;
      --border-light: #e5e7eb;
      --text-primary: #1f2937;
      --text-secondary: #4b5563;
      --text-tertiary: #6b7280;
      --accent: #10b981;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --radius: 0.75rem;
      --radius-sm: 0.5rem;
      --radius-lg: 1rem;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* ç¬¬1å±‚ï¼šå¯¼èˆªå±‚ */
    .nav-header {
      position: sticky;
      top: 0;
      background: var(--bg);
      border-bottom: none;
      z-index: 100;
    }
    
    .nav-container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 24px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .nav-brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
      text-decoration: none;
      letter-spacing: -0.02em;
    }
    
    .nav-logo {
      height: 32px;
      width: 32px;
      border-radius: 8px;
      object-fit: contain;
    }
    
    .nav-links {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }
    
    .nav-link {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.9375rem;
      font-weight: 500;
    }
    
    .nav-link:hover {
      color: var(--text-primary);
    }
    
    .nav-actions {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .lang-btn {
      min-width: 78px;
    }
    
    .btn {
      padding: 0.55rem 1.05rem;
      border-radius: var(--radius-sm);
      font-size: 0.84rem;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      border: 1px solid transparent;
      line-height: 1.1;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .btn-secondary {
      background: var(--surface);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }
    
    /* ç¬¬2å±‚ï¼šå·¥å…·å±‚ */
    .toolbar-header {
      background: var(--bg);
      border-bottom: 1px solid var(--border-light);
    }
    
    .toolbar-container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 16px 24px;
    }
    
    .toolbar-row {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }
    
    .search-box {
      flex: 0 1 640px;
      min-width: 280px;
      padding: 0.75rem 1rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 0.9375rem;
      color: var(--text-primary);
    }
    
    .search-box:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
    }
    
    .search-box::placeholder {
      color: var(--text-tertiary);
    }
    
    .toolbar-controls {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-left: auto;
    }
    
    select {
      padding: 0.75rem 1rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      color: var(--text-primary);
      cursor: pointer;
    }
    
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
    }
    
    .stats-bar {
      max-width: 1280px;
      margin: 0 auto;
      padding: 12px 24px;
      color: var(--text-tertiary);
      font-size: 0.8125rem;
      border-bottom: 1px solid var(--border-light);
    }
    
    /* HeroåŒºåŸŸ */
    .hero {
      max-width: 1280px;
      margin: 0 auto;
      padding: 48px 24px;
      min-height: calc(100vh - 64px); /* é¦–å±é«˜åº¦ï¼ˆæ‰£æ‰å¯¼èˆªï¼‰ */
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
    }
    
    .hero h1 {
      font-size: 2.5rem;
      font-weight: 700;
      line-height: 1.2;
      color: var(--text-primary);
      margin-bottom: 1rem;
      letter-spacing: -0.03em;
    }
    
    .hero p {
      font-size: 1rem;
      line-height: 1.5;
      color: var(--text-secondary);
      margin-bottom: 2rem;
      max-width: 600px;
    }
    
    .hero-actions {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    
    /* ä¸»å†…å®¹åŒº */
    main {
      max-width: 1280px;
      margin: 0 auto;
      padding: 32px 24px;
    }
    
    .section-header {
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
    }
    
    .section-header-content {
      flex: 1;
    }
    
    .section-header h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }
    
    .section-header p {
      font-size: 0.9375rem;
      color: var(--text-secondary);
    }
    
    .section-header-action {
      display: flex;
      align-items: center;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
    }
    
    .card {
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      overflow: hidden;
      position: relative;
      box-shadow: var(--shadow-sm);
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .card-preview {
      background: var(--bg);
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 1px solid var(--border-light);
      position: relative;
      overflow: hidden;
    }
    
    .card-preview iframe {
      border: none;
      width: 100%;
      height: 100%;
      background: transparent;
      transform: scale(0.7);
      transform-origin: center;
    }
    
    .card-actions {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      opacity: 0;
      pointer-events: none;
    }
    
    .card:hover .card-actions {
      opacity: 1;
      pointer-events: all;
    }
    
    .card-action-btn {
      padding: 0.5rem 1rem;
      background: var(--surface);
      color: var(--text-primary);
      border: none;
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
    }
    
    .card-action-btn.primary {
      background: var(--primary);
      color: white;
    }
    
    .card-body {
      padding: 1.25rem;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .card-title {
      font-weight: 600;
      font-size: 1rem;
      line-height: 1.5;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }
    
    .card-meta {
      font-size: 0.75rem;
      line-height: 1.5;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
    }
    
    .card-meta .category {
      color: var(--accent);
      font-weight: 500;
    }
    
    .card-meta .version {
      color: var(--text-tertiary);
      font-family: 'Monaco', 'Courier New', monospace;
    }
    
    .card-tags {
      display: flex;
      gap: 0.375rem;
      flex-wrap: wrap;
      margin-top: auto;
    }
    
    .tag {
      padding: 0.25rem 0.5rem;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.2);
      border-radius: 0.375rem;
      font-size: 0.75rem;
      color: var(--accent);
      font-weight: 500;
    }
    
    .tag-more {
      color: var(--text-tertiary);
    }
    
    .empty {
      text-align: center;
      padding: 6rem 2rem;
      color: var(--text-secondary);
      grid-column: 1 / -1;
    }
    
    .empty-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
    
    .empty h3 {
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }
    
    .loading {
      text-align: center;
      padding: 6rem 2rem;
      color: var(--text-secondary);
      grid-column: 1 / -1;
    }
    
    .btn-more {
      padding: 0;
      background: transparent;
      color: var(--primary);
      border: none;
      font-size: 0.9375rem;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      white-space: nowrap;
      transition: color 0.2s ease;
    }
    
    .btn-more:hover {
      color: var(--primary-hover);
    }
    
    @media (max-width: 768px) {
      .section-header {
        flex-direction: column;
        align-items: stretch;
      }
      
      .section-header-action {
        justify-content: flex-end;
      }
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .nav-container {
        padding: 0 16px;
        height: auto;
        min-height: 64px;
        flex-wrap: wrap;
        padding-top: 12px;
        padding-bottom: 12px;
      }
      
      .nav-links {
        display: none;
      }
      
      .toolbar-container {
        padding: 12px 16px;
      }
      
      .toolbar-row {
        flex-direction: column;
        align-items: stretch;
      }
      
      .search-box {
        flex: 1;
        min-width: 100%;
      }
      
      .toolbar-controls {
        margin-left: 0;
        width: 100%;
        justify-content: space-between;
      }
      
      .hero {
        padding: 32px 16px;
        min-height: calc(100vh - 64px);
      }
      
      .hero h1 {
        font-size: 2rem;
      }
      
      main {
        padding: 24px 16px;
      }
      
      .grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }
    
    @media (max-width: 480px) {
      .hero h1 {
        font-size: 1.75rem;
      }
      
      .btn {
        padding: 0.5rem 1rem;
        font-size: 0.8125rem;
      }
    }
  </style>
</head>
<body>
  <!-- ç¬¬1å±‚ï¼šå¯¼èˆªå±‚ -->
  <nav class="nav-header">
    <div class="nav-container">
      <a href="./index.html" class="nav-brand">
        <img src="./logo.png" alt="OLC Logo" class="nav-logo" />
        <span>Open Lab Components</span>
      </a>
      <div class="nav-links">
        <a href="./docs.html" class="nav-link" data-i18n="nav-docs">æ–‡æ¡£</a>
        <a href="./components.html" class="nav-link" data-i18n="nav-components">ç»„ä»¶</a>
      </div>
      <div class="nav-actions">
        <a href="https://github.com/itkdm/open-lab-components" class="btn btn-primary" target="_blank" rel="noopener">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
          GitHub
        </a>
        <a href="#contribute" class="btn btn-secondary" data-i18n="nav-contribute">è´¡çŒ®</a>
        <button id="langToggle" class="btn btn-secondary lang-btn" type="button">English</button>
      </div>
    </div>
  </nav>
  
  <!-- HeroåŒºåŸŸ -->
  <section class="hero">
    <h1 data-i18n="hero-title">Open Lab Components</h1>
    <p id="heroDesc" data-i18n="hero-desc">å¼€æºå®éªŒå™¨æ HTML Fragment ç»„ä»¶åº“ï¼Œä¸º STEM æ•™è‚²æä¾›å¯å¤ç”¨çš„å¯è§†åŒ–ç»„ä»¶</p>
    <div class="hero-actions">
      <a href="./components.html" class="btn btn-primary" data-i18n="hero-btn-primary">æµè§ˆç»„ä»¶</a>
      <a href="#contribute" class="btn btn-secondary" data-i18n="hero-btn-secondary">å‚ä¸è´¡çŒ®</a>
    </div>
  </section>
  
  <!-- ä¸»å†…å®¹åŒº -->
  <main id="components">
    <div class="section-header">
      <div class="section-header-content">
        <h2 data-i18n="section-title">ç»„ä»¶åˆ—è¡¨</h2>
        <p data-i18n="section-desc">æµè§ˆæ‰€æœ‰å¯ç”¨çš„å®éªŒå™¨æç»„ä»¶</p>
      </div>
      <div class="section-header-action">
        <a href="./components.html" id="moreBtn" class="btn-more" data-i18n="btn-more">æŸ¥çœ‹æ›´å¤š</a>
      </div>
    </div>
    
    <div id="grid" class="grid">
      <div class="loading" id="loadingText" data-i18n="loading">åŠ è½½ä¸­</div>
    </div>
  </main>

  <script>
    let registry = [];
    const LANG_KEY = 'olc-lang';
    const i18n = {
      zh: {
        'nav-docs': 'æ–‡æ¡£',
        'nav-components': 'ç»„ä»¶',
        'nav-spec': 'è§„èŒƒ',
        'nav-contribute': 'è´¡çŒ®',
        'hero-title': 'Open Lab Components',
        'hero-desc': 'å¼€æºå®éªŒå™¨æ HTML Fragment ç»„ä»¶åº“ï¼Œä¸º STEM æ•™è‚²æä¾›å¯å¤ç”¨çš„å¯è§†åŒ–ç»„ä»¶',
        'hero-btn-primary': 'æµè§ˆç»„ä»¶',
        'hero-btn-secondary': 'å‚ä¸è´¡çŒ®',
        'section-title': 'ç»„ä»¶åˆ—è¡¨',
        'section-desc': 'æµè§ˆæ‰€æœ‰å¯ç”¨çš„å®éªŒå™¨æç»„ä»¶',
        'loading': 'åŠ è½½ä¸­',
        'empty-title': 'æš‚æ— ç»„ä»¶',
        'empty-desc': 'è¯·å…ˆåœ¨ components ç›®å½•ä¸­æ·»åŠ ç»„ä»¶å¹¶è¿è¡Œæ„å»ºè„šæœ¬',
        'btn-more': 'æŸ¥çœ‹æ›´å¤š',
        'btn-preview': 'é¢„è§ˆ',
        'btn-copy': 'å¤åˆ¶',
        'copy-success': 'ç»„ä»¶ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿',
        'lang-label': 'English'
      },
      en: {
        'nav-docs': 'Docs',
        'nav-components': 'Components',
        'nav-spec': 'Spec',
        'nav-contribute': 'Contribute',
        'hero-title': 'Open Lab Components',
        'hero-desc': 'Open-source STEM lab equipment HTML fragment components for reusable visual blocks.',
        'hero-btn-primary': 'Browse Components',
        'hero-btn-secondary': 'Contribute',
        'section-title': 'Components',
        'section-desc': 'Browse all available lab components',
        'loading': 'Loading',
        'empty-title': 'No components yet',
        'empty-desc': 'Add components under the components directory and run the build script.',
        'btn-more': 'View More',
        'btn-preview': 'Preview',
        'btn-copy': 'Copy',
        'copy-success': 'Component code copied to clipboard',
        'lang-label': 'ä¸­æ–‡'
      }
    };

    let currentLang = localStorage.getItem(LANG_KEY) || 'zh';
    let typewriterTimer = null;

    function t(key) {
      return i18n[currentLang]?.[key] ?? i18n.zh[key] ?? key;
    }

    function getComponentName(component) {
      // ä¼˜å…ˆä½¿ç”¨ registry ä¸­çš„ nameEn å­—æ®µ
      if (currentLang === 'en' && component.nameEn) {
        return component.nameEn;
      }
      return component.name;
    }

    function getCategoryName(component) {
      // ä¼˜å…ˆä½¿ç”¨ registry ä¸­çš„ categoryNameEn å­—æ®µ
      if (currentLang === 'en' && component.categoryNameEn) {
        return component.categoryNameEn;
      }
      return component.categoryName || component.category;
    }

    function applyStaticTexts() {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        // hero-desc ä½¿ç”¨æ‰“å­—æœºæ•ˆæœï¼Œå•ç‹¬å¤„ç†
        if (key === 'hero-desc') return;
        el.textContent = t(key);
      });
      const langBtn = document.getElementById('langToggle');
      if (langBtn) langBtn.textContent = t('lang-label');
      const heroDescEl = document.getElementById('heroDesc');
      if (heroDescEl) {
        startTypewriter(heroDescEl, t('hero-desc'));
      }
      // æ›´æ–°"æŸ¥çœ‹æ›´å¤š"æŒ‰é’®æ–‡æœ¬
      const moreBtn = document.getElementById('moreBtn');
      if (moreBtn) {
        moreBtn.textContent = t('btn-more');
      }
    }

    function startTypewriter(el, text) {
      if (!el) return;
      if (typewriterTimer) {
        clearInterval(typewriterTimer);
        typewriterTimer = null;
      }
      el.textContent = '';
      let i = 0;
      const total = text.length;
      typewriterTimer = setInterval(() => {
        el.textContent = text.slice(0, i + 1);
        i++;
        if (i >= total) {
          clearInterval(typewriterTimer);
          typewriterTimer = null;
        }
      }, 60);
    }

    async function loadRegistry() {
      try {
        const res = await fetch('./registry/registry.json');
        const data = await res.json();
        registry = Array.isArray(data.items) ? data.items : (Array.isArray(data) ? data : []);
        render();
      } catch (err) {
        document.getElementById('grid').innerHTML = `
          <div class="empty">
            <div class="empty-icon">âš ï¸</div>
            <h3>${t('empty-title')}</h3>
            <p>${t('empty-desc')}</p>
          </div>
        `;
        console.error(err);
      }
    }

    function render() {
      const grid = document.getElementById('grid');
      const moreBtn = document.getElementById('moreBtn');
      const MAX_DISPLAY = 16; // é¦–é¡µæœ€å¤šæ˜¾ç¤º16ä¸ªç»„ä»¶
      
      if (!Array.isArray(registry) || registry.length === 0) {
        grid.innerHTML = `
          <div class="empty">
            <div class="empty-icon">ğŸ”</div>
            <h3>${t('empty-title')}</h3>
            <p>${t('empty-desc')}</p>
          </div>
        `;
        // å³ä½¿æ²¡æœ‰ç»„ä»¶ï¼Œä¹Ÿæ˜¾ç¤º"æŸ¥çœ‹æ›´å¤š"æŒ‰é’®ï¼Œè®©ç”¨æˆ·å¯ä»¥è·³è½¬åˆ°ç»„ä»¶åˆ—è¡¨é¡µ
        if (moreBtn) moreBtn.style.display = 'inline-flex';
        return;
      }

      // åªæ˜¾ç¤ºå‰16ä¸ªç»„ä»¶
      const displayItems = registry.slice(0, MAX_DISPLAY);
      
      grid.innerHTML = displayItems.map(c => {
        const categoryPath = c.category.replace('/', '/');
        const componentPath = `./components/${categoryPath}/${c.id}.html`;
        const tags = c.tags || [];
        const tagsHtml = tags.slice(0, 3).map(t => `<span class="tag">${t}</span>`).join('');
        const moreTags = tags.length > 3 ? `<span class="tag tag-more">+${tags.length - 3}</span>` : '';
        
        return `
          <div class="card" onclick="openPlayground('${c.id}')">
            <div class="card-preview">
              <iframe src="${componentPath}" scrolling="no"></iframe>
              <div class="card-actions">
                <button class="card-action-btn primary" onclick="event.stopPropagation(); openPlayground('${c.id}')">${t('btn-preview')}</button>
                <button class="card-action-btn" onclick="event.stopPropagation(); copyComponent('${c.id}')">${t('btn-copy')}</button>
              </div>
            </div>
            <div class="card-body">
              <div class="card-title">${getComponentName(c)}</div>
              <div class="card-meta">
                <span class="category">${getCategoryName(c)}</span>
                <span> Â· </span>
                <span class="version">v${c.version}</span>
              </div>
              <div class="card-tags">${tagsHtml}${moreTags}</div>
            </div>
          </div>
        `;
      }).join('');
      
      // æ˜¾ç¤º"æŸ¥çœ‹æ›´å¤š"æŒ‰é’®ï¼ˆä½œä¸ºå¯¼èˆªæŒ‰é’®ï¼Œå§‹ç»ˆæ˜¾ç¤ºï¼‰
      if (moreBtn) {
        moreBtn.style.display = 'inline-flex';
      }
    }

    function openPlayground(id) {
      window.location.href = `./playground.html?id=${id}`;
    }

    async function getComponentHTML(path) {
      try {
        const res = await fetch(path);
        let text = await res.text();
        
        // ç§»é™¤ @cmp-manifest æ³¨é‡Šå—
        text = text.replace(/<!--\s*@cmp-manifest[\s\S]*?-->/g, '').trim();
        
        // å¦‚æœåŒ…å«å®Œæ•´çš„ HTML æ–‡æ¡£ç»“æ„ï¼Œæå– body å†…å®¹
        if (text.indexOf('<body>') !== -1) {
          const bodyMatch = text.match(/<body[^>]*>([\s\S]*)<\/body>/i);
          if (bodyMatch) {
            text = bodyMatch[1].trim();
          }
        }
        
        // ç¡®ä¿è¿”å›çš„ä»£ç æœ‰é€‚å½“çš„ç¼©è¿›
        const lines = text.split('\n');
        const indented = lines.map((line, index) => {
          // ç¬¬ä¸€è¡Œä¸ç¼©è¿›ï¼Œå…¶ä»–è¡Œç¼©è¿› 2 ä¸ªç©ºæ ¼
          if (index === 0) return line.trim();
          return '  ' + line;
        }).join('\n');
        
        return indented;
      } catch (err) {
        console.error('Failed to load component HTML:', err);
        return '  <!-- ç»„ä»¶å†…å®¹ -->';
      }
    }

    async function copyComponent(id) {
      const component = registry.find(c => c.id === id);
      if (!component) return;
      
      try {
        // è·å–ç»„ä»¶è·¯å¾„
        const categoryPath = component.category.replace('/', '/');
        const componentPath = `./components/${categoryPath}/${component.id}.html`;
        
        // è·å–ç»„ä»¶çš„å®é™… HTML å†…å®¹
        const componentHtml = await getComponentHTML(componentPath);
        
        // æ„å»º CSS å˜é‡ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰
        const cssVars = {};
        if (component.cssVars && component.props) {
          component.props.forEach(prop => {
            const cssVar = component.cssVars[prop.key];
            if (cssVar) {
              let val = prop.default;
              if (prop.type === 'number(px)') {
                val = val + 'px';
              } else if (prop.type === 'number(deg)') {
                val = val + 'deg';
              }
              cssVars[cssVar] = val;
            }
          });
        }
        
        // ç”Ÿæˆ style å­—ç¬¦ä¸²
        const styleStr = Object.entries(cssVars)
          .map(([k, v]) => `${k}: ${v}`)
          .join('; ');
        
        // ç”Ÿæˆå®Œæ•´çš„ç»„ä»¶ä»£ç 
        let code;
        if (styleStr) {
          code = `<div class="cmp" data-cmp-id="${component.id}" style="${styleStr}">
${componentHtml}
</div>`;
        } else {
          code = `<div class="cmp" data-cmp-id="${component.id}">
${componentHtml}
</div>`;
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(code);
          alert(t('copy-success'));
        } else {
          fallbackCopy(code);
        }
      } catch (err) {
        console.error('Failed to copy component:', err);
        // å¦‚æœè·å–ç»„ä»¶å†…å®¹å¤±è´¥ï¼Œè‡³å°‘å¤åˆ¶ä¸€ä¸ªåŸºæœ¬çš„å ä½ç¬¦
        const fallbackCode = `<div class="cmp" data-cmp-id="${component.id}">
  <!-- ç»„ä»¶å†…å®¹ -->
</div>`;
        fallbackCopy(fallbackCode);
      }
    }

    function fallbackCopy(code) {
      const textarea = document.createElement('textarea');
      textarea.value = code;
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      alert(t('copy-success'));
    }

    window.copyComponent = copyComponent;

    function switchLang() {
      currentLang = currentLang === 'zh' ? 'en' : 'zh';
      localStorage.setItem(LANG_KEY, currentLang);
      applyStaticTexts();
      render(); // re-render text blocks using t()
    }

    const langToggle = document.getElementById('langToggle');
    if (langToggle) {
      langToggle.addEventListener('click', switchLang);
    }

    applyStaticTexts();
    loadRegistry();
  </script>
</body>
</html>
