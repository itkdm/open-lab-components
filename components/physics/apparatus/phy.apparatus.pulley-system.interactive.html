<!-- @cmp-manifest
{
  "schema": "cmp-manifest/v1",
  "id": "phy.apparatus.pulley-system.interactive",
  "name": "æ»‘è½®ç»„ï¼ˆäº¤äº’å¼ï¼‰",
  "nameEn": "Pulley System (Interactive)",
  "category": "physics/apparatus",
  "version": "1.3.0",
  "viewport": { "w": 220, "h": 440 },
  "props": [
    { "key": "size",         "type": "number(px)", "default": 440, "min": 280, "max": 700, "desc": "ç»„ä»¶é«˜åº¦ï¼ˆå®½åº¦æŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼‰" },
    { "key": "stroke",       "type": "color",  "default": "#333333", "desc": "æè¾¹é¢œè‰²" },
    { "key": "strokeWidth",  "type": "number", "default": 2,   "min": 0.5, "max": 5, "desc": "æè¾¹ç²—ç»†" },
    { "key": "wheelColor",   "type": "color",  "default": "#b0b0b0", "desc": "æ»‘è½®é¢œè‰²" },
    { "key": "wheelEdge",    "type": "color",  "default": "#888888", "desc": "æ»‘è½®è¾¹ç¼˜æ·±è‰²" },
    { "key": "axleColor",    "type": "color",  "default": "#555555", "desc": "è½´å¿ƒé¢œè‰²" },
    { "key": "bracketColor", "type": "color",  "default": "#666666", "desc": "æ”¯æ¶/æ¡†æ¶é¢œè‰²" },
    { "key": "ropeColor",    "type": "color",  "default": "#8B7355", "desc": "ç»³ç´¢é¢œè‰²" },
    { "key": "ropeWidth",    "type": "number", "default": 2.5, "min": 1.5, "max": 6, "desc": "ç»³ç´¢ç²—ç»†" },
    { "key": "loadMass",     "type": "number", "default": 200, "min": 0, "max": 5000, "desc": "è´Ÿè½½è´¨é‡(g)" },
    { "key": "unit",         "type": "enum",   "default": "g", "enum": ["g","kg"], "desc": "è´¨é‡å•ä½" },
    { "key": "blockEdge",    "type": "color",  "default": "#bdbdbd", "desc": "ç ç è¾¹ç¼˜è‰²" },
    { "key": "blockCenter",  "type": "color",  "default": "#e7e7e7", "desc": "ç ç ä¸­å¿ƒè‰²" },
    { "key": "hookColor",    "type": "color",  "default": "#111827", "desc": "é’©å­é¢œè‰²" },
    { "key": "accent",       "type": "color",  "default": "#1565c0", "desc": "å¼ºè°ƒè‰²ï¼ˆåŠ›å€¼æ–‡å­—ï¼‰" },
    { "key": "glow",         "type": "number(0-1)", "default": 0, "min": 0, "max": 1, "desc": "å¼ºè°ƒ/äº®åº¦ï¼ˆå¯é€‰ï¼‰" }
  ],
  "cssVars": {
    "size":         "--cmp-size",
    "stroke":       "--cmp-stroke",
    "strokeWidth":  "--cmp-stroke-width",
    "wheelColor":   "--cmp-wheel",
    "wheelEdge":    "--cmp-wheel-edge",
    "axleColor":    "--cmp-axle",
    "bracketColor": "--cmp-bracket",
    "ropeColor":    "--cmp-rope",
    "ropeWidth":    "--cmp-rope-width",
    "blockEdge":    "--cmp-block-edge",
    "blockCenter":  "--cmp-block-center",
    "hookColor":    "--cmp-hook",
    "accent":       "--cmp-accent",
    "glow":         "--cmp-glow"
  },
  "tags": ["pulley", "pulley-system", "compound-pulley", "simple-machine", "mechanics", "interactive", "draggable"]
}
-->
<div class="cmp" data-cmp-id="phy.apparatus.pulley-system.interactive" role="img" aria-label="æ»‘è½®ç»„ï¼ˆäº¤äº’å¼ï¼‰">
    <style>
      .cmp[data-cmp-id="phy.apparatus.pulley-system.interactive"] {
        --h: var(--cmp-size, 440px);
        display: inline-block;
        width: calc(var(--h) * 0.5);
        height: var(--h);
        filter: drop-shadow(0 0 calc(8px * var(--cmp-glow, 0))
                rgba(255,214,102, calc(0.8 * var(--cmp-glow, 0))));
        user-select: none;
        touch-action: none;
      }
      .cmp[data-cmp-id="phy.apparatus.pulley-system.interactive"] svg {
        width: 100%; height: 100%; display: block; overflow: visible;
      }
      .cmp[data-cmp-id="phy.apparatus.pulley-system.interactive"] .ps__handle {
        cursor: ns-resize;
      }
      .cmp[data-cmp-id="phy.apparatus.pulley-system.interactive"] .ps__force-text {
        font-family: 'Courier New', Courier, monospace;
        font-weight: 700;
        font-variant-numeric: tabular-nums;
      }
      .cmp[data-cmp-id="phy.apparatus.pulley-system.interactive"] .ps__mass-text {
        font-family: Arial, sans-serif;
        font-weight: 800;
        font-size: 11px;
        fill: rgba(0, 0, 0, 0.92);
      }
      .cmp[data-cmp-id="phy.apparatus.pulley-system.interactive"] .ps__label-text {
        font-family: Arial, sans-serif;
        font-size: 9px;
        fill: var(--cmp-accent, #1565c0);
        font-weight: 700;
      }
    </style>
  
    <svg viewBox="0 0 220 440" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <defs>
        <radialGradient id="ps__wg" cx="0.4" cy="0.35" r="0.6">
          <stop offset="0"    stop-color="var(--cmp-wheel, #b0b0b0)"/>
          <stop offset="0.85" stop-color="var(--cmp-wheel, #b0b0b0)"/>
          <stop offset="1"    stop-color="var(--cmp-wheel-edge, #888)"/>
        </radialGradient>
        <linearGradient id="ps__bg" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0"   stop-color="var(--cmp-bracket, #666)"/>
          <stop offset="0.5" stop-color="#999"/>
          <stop offset="1"   stop-color="var(--cmp-bracket, #666)"/>
        </linearGradient>
        <linearGradient id="ps__block" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0"   stop-color="var(--cmp-block-edge, #bdbdbd)"/>
          <stop offset="0.5" stop-color="var(--cmp-block-center, #e7e7e7)"/>
          <stop offset="1"   stop-color="var(--cmp-block-edge, #bdbdbd)"/>
        </linearGradient>
      </defs>
  
      <!-- â•â•â• 1. å¤©èŠ±æ¿ â•â•â• -->
      <rect x="25" y="0" width="170" height="12" rx="3"
            fill="#4a4a4a" stroke="var(--cmp-stroke, #333)" stroke-width="1.5"/>
  
      <!-- â•â•â• 2. å®šæ»‘è½®æ”¯æ¶ï¼ˆåå³ï¼‰ â•â•â• -->
      <line x1="130" y1="12" x2="130" y2="32"
            stroke="var(--cmp-bracket, #666)" stroke-width="5" stroke-linecap="round"/>
      <line x1="130" y1="32" x2="114" y2="44"
            stroke="url(#ps__bg)" stroke-width="4" stroke-linecap="round"/>
      <line x1="130" y1="32" x2="146" y2="44"
            stroke="url(#ps__bg)" stroke-width="4" stroke-linecap="round"/>
      <line x1="114" y1="44" x2="114" y2="56"
            stroke="url(#ps__bg)" stroke-width="3" stroke-linecap="round"/>
      <line x1="146" y1="44" x2="146" y2="56"
            stroke="url(#ps__bg)" stroke-width="3" stroke-linecap="round"/>
  
      <!-- â•â•â• 3. ç»³ç´¢ â•â•â• -->
      <!-- S1: å›ºå®šç«¯(å¤©èŠ±æ¿) â†’ åŠ¨è½®å·¦åˆ‡ç‚¹ -->
      <line class="ps__rope-s1" stroke="var(--cmp-rope, #8B7355)" stroke-width="var(--cmp-rope-width, 2.5)" stroke-linecap="round"/>
      <!-- A1: åŠ¨è½®åº•å¼§ -->
      <path class="ps__rope-a1" fill="none" stroke="var(--cmp-rope, #8B7355)" stroke-width="var(--cmp-rope-width, 2.5)" stroke-linecap="round"/>
      <!-- S2: åŠ¨è½®å³åˆ‡ç‚¹ â†’ å®šè½®å·¦åˆ‡ç‚¹ï¼ˆæ–œå‘å·¦ä¸Šï¼‰ -->
      <line class="ps__rope-s2" stroke="var(--cmp-rope, #8B7355)" stroke-width="var(--cmp-rope-width, 2.5)" stroke-linecap="round"/>
      <!-- A2: å®šè½®é¡¶å¼§ï¼ˆå·¦â†’å³ï¼‰ -->
      <path class="ps__rope-a2" fill="none" stroke="var(--cmp-rope, #8B7355)" stroke-width="var(--cmp-rope-width, 2.5)" stroke-linecap="round"/>
      <!-- S3: å®šè½®å³åˆ‡ç‚¹ â†’ æ–½åŠ›ç«¯ç«–ç›´å‘ä¸‹ -->
      <line class="ps__rope-s3" stroke="var(--cmp-rope, #8B7355)" stroke-width="var(--cmp-rope-width, 2.5)" stroke-linecap="round"/>
  
      <!-- â•â•â• 4. å®šæ»‘è½®ï¼ˆåå³ x=130ï¼‰ â•â•â• -->
      <circle cx="130" cy="56" r="22"
              fill="url(#ps__wg)" stroke="var(--cmp-stroke, #333)"
              stroke-width="var(--cmp-stroke-width, 2)"/>
      <circle cx="130" cy="56" r="18" fill="none"
              stroke="var(--cmp-wheel-edge, #888)" stroke-width="1"
              stroke-dasharray="3,2.5" opacity="0.35"/>
      <g class="ps__spokes-fixed" stroke="var(--cmp-wheel-edge, #888)" stroke-width="0.8" opacity="0.4">
        <line x1="130" y1="38" x2="130" y2="74"/>
        <line x1="112" y1="56" x2="148" y2="56"/>
        <line x1="117.3" y1="43.3" x2="142.7" y2="68.7"/>
        <line x1="142.7" y1="43.3" x2="117.3" y2="68.7"/>
      </g>
      <circle cx="130" cy="56" r="4.5" fill="var(--cmp-axle, #555)"
              stroke="var(--cmp-stroke, #333)" stroke-width="1.2"/>
      <circle cx="130" cy="56" r="2" fill="#777"/>
      <text x="158" y="52" class="ps__label-text">å®š</text>
  
      <!-- â•â•â• 5. åŠ¨æ»‘è½®ï¼ˆåå·¦ x=80ï¼‰ â•â•â• -->
      <circle class="ps__mov-outer" cx="80" cy="230" r="22"
              fill="url(#ps__wg)" stroke="var(--cmp-stroke, #333)"
              stroke-width="var(--cmp-stroke-width, 2)"/>
      <circle class="ps__mov-groove" cx="80" cy="230" r="18" fill="none"
              stroke="var(--cmp-wheel-edge, #888)" stroke-width="1"
              stroke-dasharray="3,2.5" opacity="0.35"/>
      <g class="ps__spokes-mov" stroke="var(--cmp-wheel-edge, #888)" stroke-width="0.8" opacity="0.4">
        <line x1="80" y1="212" x2="80" y2="248"/>
        <line x1="62" y1="230" x2="98" y2="230"/>
        <line x1="67.3" y1="217.3" x2="92.7" y2="242.7"/>
        <line x1="92.7" y1="217.3" x2="67.3" y2="242.7"/>
      </g>
      <circle class="ps__mov-axle1" cx="80" cy="230" r="4.5" fill="var(--cmp-axle, #555)"
              stroke="var(--cmp-stroke, #333)" stroke-width="1.2"/>
      <circle class="ps__mov-axle2" cx="80" cy="230" r="2" fill="#777"/>
      <text class="ps__mov-label" x="42" y="226"
            font-family="Arial, sans-serif" font-size="9" fill="var(--cmp-accent, #1565c0)" font-weight="700">åŠ¨</text>
  
      <!-- â•â•â• 6. å›ºå®šç«¯ â•â•â• -->
      <rect class="ps__anchor" x="56" y="10" width="12" height="10" rx="2"
            fill="#555" stroke="var(--cmp-stroke, #333)" stroke-width="1"/>
  
      <!-- â•â•â• 7. åŠ¨æ»‘è½®æ¡†æ¶ â•â•â• -->
      <line class="ps__frame-left"  stroke="url(#ps__bg)" stroke-width="3.5" stroke-linecap="round"/>
      <line class="ps__frame-right" stroke="url(#ps__bg)" stroke-width="3.5" stroke-linecap="round"/>
      <line class="ps__frame-bot"   stroke="url(#ps__bg)" stroke-width="3" stroke-linecap="round"/>
      <line class="ps__frame-rod"   stroke="var(--cmp-bracket, #666)" stroke-width="3" stroke-linecap="round"/>
  
      <!-- â•â•â• 8. åŒé’©å­ + ç ç  â•â•â• -->
      <path class="ps__frame-hook" fill="none"
            stroke="var(--cmp-hook, #111827)"
            stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
      <path class="ps__load-hook" fill="none"
            stroke="var(--cmp-hook, #111827)"
            stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
      <rect class="ps__load-block" width="44" height="50" rx="1"
            fill="url(#ps__block)" stroke="var(--cmp-stroke, #333)"
            stroke-width="1.4"/>
      <text class="ps__mass-text" text-anchor="middle"></text>
  
      <!-- â•â•â• 9. æ–½åŠ›ç«¯ â•â•â• -->
      <g class="ps__handle">
        <circle class="ps__pull-dot" r="4" fill="var(--cmp-accent, #1565c0)" opacity="0.7"/>
        <polygon class="ps__pull-arrow" fill="var(--cmp-accent, #1565c0)"/>
        <line class="ps__pull-line" stroke="var(--cmp-accent, #1565c0)"
              stroke-width="2.5" stroke-linecap="round"/>
        <text class="ps__force-text" text-anchor="start"
              font-size="11" fill="var(--cmp-accent, #1565c0)"></text>
        <rect class="ps__hit" fill="transparent" cursor="ns-resize"/>
      </g>
    </svg>
  
    <script>
    (function() {
      var script = document.currentScript;
      if (!script) return;
      var root = script.parentElement;
      if (!root || root.getAttribute('data-cmp-id') !== 'phy.apparatus.pulley-system.interactive') return;
  
      var svg = root.querySelector('svg');
      if (!svg) return;
  
      /* â”€â”€â”€ å‚æ•° â”€â”€â”€ */
      var P = {};
      try {
        var raw = root.getAttribute('data-props');
        if (raw) { var o = JSON.parse(raw); if (o && typeof o === 'object') P = o; }
      } catch(e) {}
  
      var loadMass = Math.max(0, Number(P.loadMass) || 200);
      var massUnit = (P.unit === 'kg') ? 'kg' : 'g';
  
      /* â”€â”€â”€ å‡ ä½•å¸¸é‡ â”€â”€â”€ */
      /*
       * æ— äº¤å‰ç»³ç´¢è·¯å¾„ï¼ˆv1.3ï¼‰ï¼š
       *
       *   å¤©èŠ±æ¿ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       *   â”ƒ(å›ºå®š)         â”Œâ”€å®šâ”€â”
       *   â”ƒ S1            â”‚ â— â”‚        S3 â† æ–½åŠ›ç«¯â†“ ç«–ç›´
       *   â”ƒ â”‚        A2 â•± â””â”€â”€â”€â”˜ â•² S3
       *   â”ƒ â”‚      â•±  å·¦åˆ‡ç‚¹  å³åˆ‡ç‚¹  â”‚
       *   â”ƒ â”‚  S2â•±                   â”‚
       *   â”ƒ â”‚ â•±                      â—
       *   â”ƒ â”Œâ”€åŠ¨â”€â”                   â†“ F=0.65N
       *   â”ƒ â”‚ â— â”‚
       *   â”ƒ â””â”€â”¬â”€â”˜
       *   â”ƒ   â”‚æ¡†æ¶
       *   â”ƒ  ğŸªğŸª
       *   â”ƒ â”Œâ”€â”€â”€â”€â”€â”
       *   â”ƒ â”‚200 gâ”‚
       *   â”ƒ â””â”€â”€â”€â”€â”€â”˜
       *
       *   S1: å›ºå®šç«¯(62) â†’ åŠ¨è½®å·¦åˆ‡ç‚¹(62)     ç«–ç›´ â†“
       *   A1: åŠ¨è½®åº•å¼§ (62â†’98)                åº•å¼§
       *   S2: åŠ¨è½®å³åˆ‡ç‚¹(98) â†’ å®šè½®å·¦åˆ‡ç‚¹(112)  æ–œå‘å·¦ä¸Š â•±
       *   A2: å®šè½®é¡¶å¼§ (112â†’148)               é¡¶å¼§ å·¦â†’å³
       *   S3: å®šè½®å³åˆ‡ç‚¹(148) â†’ æ–½åŠ›ç«¯          ç«–ç›´ â†“
       *
       *   ä¸‰æ ¹ç«–ç›´/æ–œçº¿ï¼šS1(x=62), S2(æ–œ), S3(x=148)
       *   å…¨éƒ¨åœ¨ä¸åŒ x åŒºåŸŸï¼Œé›¶äº¤å‰ï¼
       */
  
      var FIX_CX = 130, FIX_CY = 56, FIX_R = 18;
      var FIX_LX = FIX_CX - FIX_R;  /* 112 */
      var FIX_RX = FIX_CX + FIX_R;  /* 148 */
  
      var MOV_CX = 80, MOV_R = 18;
      var MOV_LX = MOV_CX - MOV_R;  /* 62 */
      var MOV_RX = MOV_CX + MOV_R;  /* 98 */
  
      var ANCHOR_Y = 20;
      var MOV_MIN_CY = 100;
      var MOV_MAX_CY = 280;
      var MOV_TRAVEL = MOV_MAX_CY - MOV_MIN_CY;
  
      var ratio = 0.15;
  
      /* â”€â”€â”€ DOM â”€â”€â”€ */
      var ropeS1 = root.querySelector('.ps__rope-s1');
      var ropeA1 = root.querySelector('.ps__rope-a1');
      var ropeS2 = root.querySelector('.ps__rope-s2');
      var ropeA2 = root.querySelector('.ps__rope-a2');
      var ropeS3 = root.querySelector('.ps__rope-s3');
  
      var spokesFixed = root.querySelector('.ps__spokes-fixed');
      var spokesMov   = root.querySelector('.ps__spokes-mov');
      var movOuter    = root.querySelector('.ps__mov-outer');
      var movGroove   = root.querySelector('.ps__mov-groove');
      var movAxle1    = root.querySelector('.ps__mov-axle1');
      var movAxle2    = root.querySelector('.ps__mov-axle2');
      var movLabel    = root.querySelector('.ps__mov-label');
  
      var frameLeft  = root.querySelector('.ps__frame-left');
      var frameRight = root.querySelector('.ps__frame-right');
      var frameBot   = root.querySelector('.ps__frame-bot');
      var frameRod   = root.querySelector('.ps__frame-rod');
  
      var frameHook = root.querySelector('.ps__frame-hook');
      var loadHook  = root.querySelector('.ps__load-hook');
      var loadBlock = root.querySelector('.ps__load-block');
      var massTxt   = root.querySelector('.ps__mass-text');
  
      var pullDot   = root.querySelector('.ps__pull-dot');
      var pullArrow = root.querySelector('.ps__pull-arrow');
      var pullLine  = root.querySelector('.ps__pull-line');
      var forceTxt  = root.querySelector('.ps__force-text');
      var hitRect   = root.querySelector('.ps__hit');
  
      /* â”€â”€â”€ æ¸²æŸ“ â”€â”€â”€ */
      function render() {
        var mcy = MOV_MAX_CY - ratio * MOV_TRAVEL;
  
        /* â”€â”€ ç»³ç´¢ â”€â”€ */
  
        /* S1: å›ºå®šç«¯(62, 20) â†’ åŠ¨è½®å·¦åˆ‡ç‚¹(62, mcy) ç«–ç›´ */
        if (ropeS1) {
          ropeS1.setAttribute('x1', MOV_LX); ropeS1.setAttribute('y1', ANCHOR_Y);
          ropeS1.setAttribute('x2', MOV_LX); ropeS1.setAttribute('y2', mcy);
        }
  
        /* A1: åŠ¨è½®åº•å¼§ (å·¦62 â†’ åº• â†’ å³98) */
        if (ropeA1) {
          ropeA1.setAttribute('d',
            'M' + MOV_LX + ',' + mcy +
            ' A' + MOV_R + ',' + MOV_R + ' 0 1,0 ' + MOV_RX + ',' + mcy);
        }
  
        /* S2: åŠ¨è½®å³åˆ‡ç‚¹(98, mcy) â†’ å®šè½®å·¦åˆ‡ç‚¹(112, 56) æ–œå‘å·¦ä¸Š */
        if (ropeS2) {
          ropeS2.setAttribute('x1', MOV_RX); ropeS2.setAttribute('y1', mcy);
          ropeS2.setAttribute('x2', FIX_LX); ropeS2.setAttribute('y2', FIX_CY);
        }
  
        /* A2: å®šè½®é¡¶å¼§ (å·¦112 â†’ é¡¶ â†’ å³148)
         * ä»å·¦åˆ‡ç‚¹ç»é¡¶éƒ¨åˆ°å³åˆ‡ç‚¹ï¼šsweep=1, large-arc=1 */
        if (ropeA2) {
          ropeA2.setAttribute('d',
            'M' + FIX_LX + ',' + FIX_CY +
            ' A' + FIX_R + ',' + FIX_R + ' 0 1,1 ' + FIX_RX + ',' + FIX_CY);
        }
  
        /* S3: å®šè½®å³åˆ‡ç‚¹(148, 56) â†’ æ–½åŠ›ç«¯ç«–ç›´å‘ä¸‹
         * æ³¨æ„ï¼šratio è¶Šå¤§ï¼ŒåŠ¨æ»‘è½®è¶Šâ€œä¸Šå»â€ï¼ˆmcy å˜å°ï¼‰ï¼Œ
         * ä½†å³ä¾§è‡ªç”±ç«¯ç»³å­åº”è¯¥è¶Šâ€œæ‹‰é•¿â€ï¼ˆy å¢å¤§ï¼‰ã€‚
         * å› æ­¤è¿™é‡Œä¸è¦ç›´æ¥ç”¨ mcy çº¿æ€§æ’å€¼ï¼Œè€Œæ˜¯ç”¨ ratio æ­£ç›¸å…³åœ°æ’å€¼ã€‚ */
        var pullMinY = FIX_CY + 60;   /* ç»³å­æœ€çŸ­æ—¶ï¼ˆratio=0ï¼‰æœ«ç«¯ä½ç½® */
        var pullMaxY = 380;          /* ç»³å­æœ€é•¿æ—¶ï¼ˆratio=1ï¼‰æœ«ç«¯ä½ç½®ï¼Œç•¥é«˜äºè§†å›¾åº•éƒ¨ */
        var pullEndY = pullMinY + ratio * (pullMaxY - pullMinY);
        if (ropeS3) {
          ropeS3.setAttribute('x1', FIX_RX); ropeS3.setAttribute('y1', FIX_CY);
          ropeS3.setAttribute('x2', FIX_RX); ropeS3.setAttribute('y2', pullEndY);
        }
  
        /* â”€â”€ å®šæ»‘è½®è¾æ¡æ—‹è½¬ â”€â”€ */
        if (spokesFixed) {
          spokesFixed.setAttribute('transform',
            'rotate(' + (ratio * 540).toFixed(1) + ',' + FIX_CX + ',' + FIX_CY + ')');
        }
  
        /* â”€â”€ åŠ¨æ»‘è½®ä½ç½® â”€â”€ */
        if (movOuter)  { movOuter.setAttribute('cx', MOV_CX);  movOuter.setAttribute('cy', mcy); }
        if (movGroove) { movGroove.setAttribute('cx', MOV_CX); movGroove.setAttribute('cy', mcy); }
        if (movAxle1)  { movAxle1.setAttribute('cx', MOV_CX);  movAxle1.setAttribute('cy', mcy); }
        if (movAxle2)  { movAxle2.setAttribute('cx', MOV_CX);  movAxle2.setAttribute('cy', mcy); }
        if (movLabel)  { movLabel.setAttribute('y', mcy - 4); }
  
        var ms = spokesMov ? spokesMov.querySelectorAll('line') : [];
        if (ms.length === 4) {
          var sr = MOV_R + 4, sd = sr * 0.707;
          ms[0].setAttribute('x1', MOV_CX);      ms[0].setAttribute('y1', mcy - sr);
          ms[0].setAttribute('x2', MOV_CX);      ms[0].setAttribute('y2', mcy + sr);
          ms[1].setAttribute('x1', MOV_CX - sr);  ms[1].setAttribute('y1', mcy);
          ms[1].setAttribute('x2', MOV_CX + sr);  ms[1].setAttribute('y2', mcy);
          ms[2].setAttribute('x1', MOV_CX - sd);  ms[2].setAttribute('y1', mcy - sd);
          ms[2].setAttribute('x2', MOV_CX + sd);  ms[2].setAttribute('y2', mcy + sd);
          ms[3].setAttribute('x1', MOV_CX + sd);  ms[3].setAttribute('y1', mcy - sd);
          ms[3].setAttribute('x2', MOV_CX - sd);  ms[3].setAttribute('y2', mcy + sd);
        }
        if (spokesMov) {
          spokesMov.setAttribute('transform',
            'rotate(' + (ratio * 720).toFixed(1) + ',' + MOV_CX + ',' + mcy + ')');
        }
  
        /* â”€â”€ åŠ¨æ»‘è½®æ¡†æ¶ â”€â”€ */
        if (frameLeft) {
          frameLeft.setAttribute('x1', MOV_CX - 10); frameLeft.setAttribute('y1', mcy);
          frameLeft.setAttribute('x2', MOV_CX - 5);  frameLeft.setAttribute('y2', mcy + 20);
        }
        if (frameRight) {
          frameRight.setAttribute('x1', MOV_CX + 10); frameRight.setAttribute('y1', mcy);
          frameRight.setAttribute('x2', MOV_CX + 5);  frameRight.setAttribute('y2', mcy + 20);
        }
        if (frameBot) {
          frameBot.setAttribute('x1', MOV_CX - 5); frameBot.setAttribute('y1', mcy + 20);
          frameBot.setAttribute('x2', MOV_CX + 5); frameBot.setAttribute('y2', mcy + 20);
        }
        if (frameRod) {
          frameRod.setAttribute('x1', MOV_CX); frameRod.setAttribute('y1', mcy + 20);
          frameRod.setAttribute('x2', MOV_CX); frameRod.setAttribute('y2', mcy + 27);
        }
  
        /* â”€â”€ åŒé’©å­ â”€â”€ */
        var hookBaseY = mcy + 27;
        if (frameHook) {
          var fhy = hookBaseY;
          frameHook.setAttribute('d',
            'M' + MOV_CX + ',' + fhy +
            ' L' + MOV_CX + ',' + (fhy + 3) +
            ' C' + MOV_CX + ',' + (fhy + 12) +
            ' ' + (MOV_CX - 14) + ',' + (fhy + 12) +
            ' ' + (MOV_CX - 14) + ',' + (fhy + 3) +
            ' C' + (MOV_CX - 14) + ',' + (fhy - 2) +
            ' ' + (MOV_CX - 8) + ',' + (fhy - 1) +
            ' ' + (MOV_CX - 7) + ',' + (fhy + 2));
        }
        var whY = hookBaseY + 12;
        if (loadHook) {
          loadHook.setAttribute('d',
            'M' + (MOV_CX - 7) + ',' + whY +
            ' C' + (MOV_CX - 7) + ',' + (whY - 7) +
            ' ' + (MOV_CX + 7) + ',' + (whY - 7) +
            ' ' + (MOV_CX + 7) + ',' + whY +
            ' C' + (MOV_CX + 7) + ',' + (whY + 6) +
            ' ' + (MOV_CX + 1) + ',' + (whY + 5) +
            ' ' + MOV_CX + ',' + (whY + 9) +
            ' L' + MOV_CX + ',' + (whY + 12));
        }
        var bx = MOV_CX - 22, by = whY + 12;
        if (loadBlock) { loadBlock.setAttribute('x', bx); loadBlock.setAttribute('y', by); }
        if (massTxt) {
          massTxt.textContent = (massUnit === 'kg')
            ? (Math.round(loadMass * 100) / 100) + ' kg'
            : Math.round(loadMass) + ' g';
          massTxt.setAttribute('x', MOV_CX);
          massTxt.setAttribute('y', by + 30);
        }
  
        /* â”€â”€ æ–½åŠ›ç«¯æ ‡æ³¨ï¼ˆç´§è´´ S3 ç»³æœ«ç«¯, x=148ï¼‰ â”€â”€ */
        var px = FIX_RX;  /* 148 */
        var py = pullEndY;
  
        if (pullDot) {
          pullDot.setAttribute('cx', px);
          pullDot.setAttribute('cy', py);
        }
        var arrowTopY = py + 6;
        var arrowTipY = py + 30;
        if (pullLine) {
          pullLine.setAttribute('x1', px); pullLine.setAttribute('y1', arrowTopY);
          pullLine.setAttribute('x2', px); pullLine.setAttribute('y2', arrowTipY - 8);
        }
        if (pullArrow) {
          pullArrow.setAttribute('points',
            (px - 5) + ',' + (arrowTipY - 10) + ' ' +
            px + ',' + arrowTipY + ' ' +
            (px + 5) + ',' + (arrowTipY - 10));
        }
  
        var massKg = (massUnit === 'kg') ? loadMass : loadMass / 1000;
        var force = massKg * 9.8 / 3;
        if (forceTxt) {
          forceTxt.textContent = 'F=' + force.toFixed(2) + ' N';
          forceTxt.setAttribute('x', px + 8);
          forceTxt.setAttribute('y', arrowTopY + 14);
        }
  
        if (hitRect) {
          hitRect.setAttribute('x', px - 20);
          hitRect.setAttribute('y', FIX_CY);
          hitRect.setAttribute('width', 45);
          hitRect.setAttribute('height', arrowTipY + 20 - FIX_CY);
        }
  
        root.setAttribute('aria-label',
          'æ»‘è½®ç»„ï¼ˆ1å®š1åŠ¨ï¼Œäº¤äº’å¼ï¼‰ï¼Œè´Ÿè½½ ' + Math.round(loadMass) + ' ' + massUnit +
          'ï¼Œæ–½åŠ› ' + force.toFixed(2) + ' Nï¼ˆ3æ®µç»³æ‰¿é‡ï¼ŒçœåŠ› 1/3ï¼‰');
      }
  
      render();
  
      /* â”€â”€â”€ æ‹–æ‹½ â”€â”€â”€ */
      var dragging = false;
      var startClientY = 0, startRatio = 0;
  
      function onDown(e) {
        e.preventDefault();
        dragging = true;
        var pt = e.touches ? e.touches[0] : e;
        startClientY = pt.clientY;
        startRatio = ratio;
        document.addEventListener('mousemove', onMove, { passive: false });
        document.addEventListener('mouseup',   onUp);
        document.addEventListener('touchmove', onMove, { passive: false });
        document.addEventListener('touchend',  onUp);
      }
      function onMove(e) {
        if (!dragging) return;
        e.preventDefault();
        var pt = e.touches ? e.touches[0] : e;
        var rect = svg.getBoundingClientRect();
        var scale = rect.height / 440;
        var dy = (pt.clientY - startClientY) / scale;
        var newRatio = startRatio + dy / (MOV_TRAVEL * 3);
        ratio = Math.max(0, Math.min(1, newRatio));
        render();
      }
      function onUp() {
        dragging = false;
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup',   onUp);
        document.removeEventListener('touchmove', onMove);
        document.removeEventListener('touchend',  onUp);
      }
  
      var handle = root.querySelector('.ps__handle');
      if (handle) {
        handle.addEventListener('mousedown',  onDown, { passive: false });
        handle.addEventListener('touchstart', onDown, { passive: false });
      }
  
      var cleanup = function() {
        if (handle) {
          handle.removeEventListener('mousedown', onDown);
          handle.removeEventListener('touchstart', onDown);
        }
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup', onUp);
        document.removeEventListener('touchmove', onMove);
        document.removeEventListener('touchend', onUp);
      };
      window.addEventListener('beforeunload', cleanup);
    })();
    </script>
  </div>