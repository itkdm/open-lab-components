<!-- @cmp-manifest
{
  "schema": "cmp-manifest/v1",
  "id": "phy.apparatus.pulley-movable.interactive",
  "name": "åŠ¨æ»‘è½®ï¼ˆäº¤äº’å¼ï¼‰",
  "nameEn": "Movable Pulley (Interactive)",
  "category": "physics/apparatus",
  "version": "1.3.0",
  "viewport": { "w": 200, "h": 380 },
  "props": [
    { "key": "size",         "type": "number(px)", "default": 380, "min": 240, "max": 640, "desc": "ç»„ä»¶é«˜åº¦ï¼ˆå®½åº¦æŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼‰" },
    { "key": "stroke",       "type": "color",  "default": "#333333", "desc": "æè¾¹é¢œè‰²" },
    { "key": "strokeWidth",  "type": "number", "default": 2,   "min": 0.5, "max": 5, "desc": "æè¾¹ç²—ç»†" },
    { "key": "wheelColor",   "type": "color",  "default": "#b0b0b0", "desc": "æ»‘è½®é¢œè‰²" },
    { "key": "wheelEdge",    "type": "color",  "default": "#888888", "desc": "æ»‘è½®è¾¹ç¼˜æ·±è‰²" },
    { "key": "axleColor",    "type": "color",  "default": "#555555", "desc": "è½´å¿ƒé¢œè‰²" },
    { "key": "bracketColor", "type": "color",  "default": "#666666", "desc": "æ»‘è½®æ¡†æ¶é¢œè‰²" },
    { "key": "ropeColor",    "type": "color",  "default": "#8B7355", "desc": "ç»³ç´¢é¢œè‰²" },
    { "key": "ropeWidth",    "type": "number", "default": 3,   "min": 1.5, "max": 8, "desc": "ç»³ç´¢ç²—ç»†" },
    { "key": "loadMass",     "type": "number", "default": 200, "min": 0, "max": 5000, "desc": "è´Ÿè½½è´¨é‡(g)" },
    { "key": "unit",         "type": "enum",   "default": "g", "enum": ["g","kg"], "desc": "è´¨é‡å•ä½" },
    { "key": "blockEdge",    "type": "color",  "default": "#bdbdbd", "desc": "ç ç è¾¹ç¼˜è‰²" },
    { "key": "blockCenter",  "type": "color",  "default": "#e7e7e7", "desc": "ç ç ä¸­å¿ƒè‰²" },
    { "key": "hookColor",    "type": "color",  "default": "#111827", "desc": "é’©å­é¢œè‰²" },
    { "key": "accent",       "type": "color",  "default": "#1565c0", "desc": "å¼ºè°ƒè‰²ï¼ˆåŠ›å€¼æ–‡å­—ï¼‰" },
    { "key": "glow",         "type": "number(0-1)", "default": 0, "min": 0, "max": 1, "desc": "å¼ºè°ƒ/äº®åº¦ï¼ˆå¯é€‰ï¼‰" }
  ],
  "cssVars": {
    "size":         "--cmp-size",
    "stroke":       "--cmp-stroke",
    "strokeWidth":  "--cmp-stroke-width",
    "wheelColor":   "--cmp-wheel",
    "wheelEdge":    "--cmp-wheel-edge",
    "axleColor":    "--cmp-axle",
    "bracketColor": "--cmp-bracket",
    "ropeColor":    "--cmp-rope",
    "ropeWidth":    "--cmp-rope-width",
    "blockEdge":    "--cmp-block-edge",
    "blockCenter":  "--cmp-block-center",
    "hookColor":    "--cmp-hook",
    "accent":       "--cmp-accent",
    "glow":         "--cmp-glow"
  },
  "tags": ["pulley", "movable-pulley", "simple-machine", "mechanics", "interactive", "draggable"],
  "events": [
    { "name": "cmp:change", "type": "adjust", "values": { "ratio": "number(0-1) â€” æ‹‰ç»³æ¯”ä¾‹", "force": "number(N) â€” æ‹‰åŠ›" } },
    { "name": "cmp:changeend", "type": "adjust", "values": { "ratio": "number(0-1) â€” æ‹‰ç»³æ¯”ä¾‹", "force": "number(N) â€” æ‹‰åŠ›" } }
  ]
}
-->
<div class="cmp" data-cmp-id="phy.apparatus.pulley-movable.interactive" role="img" aria-label="åŠ¨æ»‘è½®ï¼ˆäº¤äº’å¼ï¼‰">
    <style>
      .cmp[data-cmp-id="phy.apparatus.pulley-movable.interactive"] {
        --h: var(--cmp-size, 380px);
        display: inline-block;
        width: calc(var(--h) * 0.526);
        height: var(--h);
        filter: drop-shadow(0 0 calc(8px * var(--cmp-glow, 0))
                rgba(255,214,102, calc(0.8 * var(--cmp-glow, 0))));
        user-select: none;
        touch-action: none;
      }
      .cmp[data-cmp-id="phy.apparatus.pulley-movable.interactive"] svg {
        width: 100%; height: 100%; display: block; overflow: visible;
      }
      .cmp[data-cmp-id="phy.apparatus.pulley-movable.interactive"] .mpl__handle {
        cursor: ns-resize;
      }
      .cmp[data-cmp-id="phy.apparatus.pulley-movable.interactive"] .mpl__force-text {
        font-family: 'Courier New', Courier, monospace;
        font-weight: 700;
        font-variant-numeric: tabular-nums;
      }
      .cmp[data-cmp-id="phy.apparatus.pulley-movable.interactive"] .mpl__mass-text {
        font-family: Arial, sans-serif;
        font-weight: 800;
        font-size: 12px;
        fill: rgba(0, 0, 0, 0.92);
      }
    </style>
  
    <svg viewBox="0 0 200 380" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <defs>
        <radialGradient id="mpl__wg" cx="0.4" cy="0.35" r="0.6">
          <stop offset="0"    stop-color="var(--cmp-wheel, #b0b0b0)"/>
          <stop offset="0.85" stop-color="var(--cmp-wheel, #b0b0b0)"/>
          <stop offset="1"    stop-color="var(--cmp-wheel-edge, #888)"/>
        </radialGradient>
        <linearGradient id="mpl__bg" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0"   stop-color="var(--cmp-bracket, #666)"/>
          <stop offset="0.5" stop-color="#999"/>
          <stop offset="1"   stop-color="var(--cmp-bracket, #666)"/>
        </linearGradient>
        <linearGradient id="mpl__block" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0"   stop-color="var(--cmp-block-edge, #bdbdbd)"/>
          <stop offset="0.5" stop-color="var(--cmp-block-center, #e7e7e7)"/>
          <stop offset="1"   stop-color="var(--cmp-block-edge, #bdbdbd)"/>
        </linearGradient>
      </defs>
  
      <!-- â•â•â• 1. å¤©èŠ±æ¿æ¨ªæ¢ â•â•â• -->
      <rect x="35" y="0" width="130" height="12" rx="3"
            fill="#4a4a4a" stroke="var(--cmp-stroke, #333)" stroke-width="1.5"/>
  
      <!-- â•â•â• 2. å·¦ä¾§å›ºå®šç»³ç«¯ï¼ˆç³»åœ¨å¤©èŠ±æ¿ä¸Šï¼‰ â•â•â• -->
      <rect x="68" y="10" width="12" height="10" rx="2"
            fill="#555" stroke="var(--cmp-stroke, #333)" stroke-width="1"/>
  
      <!-- â•â•â• 3. ç»³ç´¢ï¼ˆä¸¤æ ¹éƒ½æ˜¯ç«–ç›´çš„ï¼Œæœ€ç®€æ´ï¼‰ â•â•â• -->
      <!-- å·¦ç»³ï¼ˆå¤©èŠ±æ¿å›ºå®š â†’ æ»‘è½®å·¦åˆ‡ç‚¹ï¼Œç«–ç›´ï¼‰ -->
      <line class="mpl__rope-left"
            x1="74" y1="20" x2="74" y2="200"
            stroke="var(--cmp-rope, #8B7355)"
            stroke-width="var(--cmp-rope-width, 3)"
            stroke-linecap="round"/>
      <!-- å¼§æ®µï¼ˆç»•æ»‘è½®åº•éƒ¨ï¼‰ -->
      <path class="mpl__rope-arc"
            d="M74,200 A26,26 0 1,0 126,200"
            fill="none"
            stroke="var(--cmp-rope, #8B7355)"
            stroke-width="var(--cmp-rope-width, 3)"
            stroke-linecap="round"/>
      <!-- å³ç»³ï¼ˆæ»‘è½®å³åˆ‡ç‚¹ â†’ å‘ä¸Šï¿½ï¿½ä¼¸ï¼Œç«–ç›´ï¼Œè¿™æ˜¯æ–½åŠ›ç«¯ï¼‰ -->
      <line class="mpl__rope-right"
            x1="126" y1="200" x2="126" y2="12"
            stroke="var(--cmp-rope, #8B7355)"
            stroke-width="var(--cmp-rope-width, 3)"
            stroke-linecap="round"/>
  
      <!-- â•â•â• 4. æ»‘è½® â•â•â• -->
      <circle class="mpl__wheel-outer" cx="100" cy="200" r="30"
              fill="url(#mpl__wg)" stroke="var(--cmp-stroke, #333)"
              stroke-width="var(--cmp-stroke-width, 2)"/>
      <circle class="mpl__wheel-groove" cx="100" cy="200" r="26" fill="none"
              stroke="var(--cmp-wheel-edge, #888)" stroke-width="1.2"
              stroke-dasharray="4,3" opacity="0.35"/>
      <g class="mpl__spokes" stroke="var(--cmp-wheel-edge, #888)" stroke-width="1" opacity="0.4">
        <line x1="100" y1="174" x2="100" y2="226"/>
        <line x1="74"  y1="200" x2="126" y2="200"/>
        <line x1="81.6" y1="181.6" x2="118.4" y2="218.4"/>
        <line x1="118.4" y1="181.6" x2="81.6" y2="218.4"/>
      </g>
      <circle class="mpl__axle-outer" cx="100" cy="200" r="6" fill="var(--cmp-axle, #555)"
              stroke="var(--cmp-stroke, #333)" stroke-width="1.5"/>
      <circle class="mpl__axle-inner" cx="100" cy="200" r="2.5" fill="#777"/>
  
      <!-- â•â•â• 5. æ¡†æ¶ â•â•â• -->
      <line class="mpl__frame-left" x1="88" y1="200" x2="94" y2="224"
            stroke="url(#mpl__bg)" stroke-width="4" stroke-linecap="round"/>
      <line class="mpl__frame-right" x1="112" y1="200" x2="106" y2="224"
            stroke="url(#mpl__bg)" stroke-width="4" stroke-linecap="round"/>
      <line class="mpl__frame-bottom" x1="94" y1="224" x2="106" y2="224"
            stroke="url(#mpl__bg)" stroke-width="3.5" stroke-linecap="round"/>
      <line class="mpl__frame-rod" x1="100" y1="224" x2="100" y2="232"
            stroke="var(--cmp-bracket, #666)" stroke-width="3.5" stroke-linecap="round"/>
  
      <!-- â•â•â• 6. åŒé’©å­ + ç ç  â•â•â• -->
      <path class="mpl__frame-hook" fill="none"
            stroke="var(--cmp-hook, #111827)"
            stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
      <path class="mpl__load-hook" fill="none"
            stroke="var(--cmp-hook, #111827)"
            stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
      <rect class="mpl__load-block" width="48" height="56" rx="1"
            fill="url(#mpl__block)" stroke="var(--cmp-stroke, #333)"
            stroke-width="1.4"/>
      <text class="mpl__mass-text" text-anchor="middle"></text>
  
      <!-- â•â•â• 7. æ–½åŠ›ç«¯ï¼ˆå³ç»³æ—è¾¹ï¼Œç®­å¤´æœä¸Šï¼‰ â•â•â• -->
      <g class="mpl__handle">
        <!-- åŠ›ç®­å¤´ï¼ˆåœ¨å³ç»³æ—è¾¹ï¼Œä¸é®æŒ¡ç»³å­ï¼‰ -->
        <polygon class="mpl__pull-arrow"
                 fill="var(--cmp-accent, #1565c0)"/>
        <line class="mpl__pull-line"
              stroke="var(--cmp-accent, #1565c0)"
              stroke-width="2.5" stroke-linecap="round"/>
        <!-- åŠ›å€¼æ–‡å­— -->
        <text class="mpl__force-text"
              text-anchor="start"
              font-size="11" fill="var(--cmp-accent, #1565c0)"></text>
        <!-- æ‹–æ‹½çƒ­åŒºï¼ˆè¦†ç›–å³ç»³ä¸ŠåŠæ®µï¼‰ -->
        <rect class="mpl__hit"
              fill="transparent" cursor="ns-resize"/>
      </g>
    </svg>
  
    <script>
    (function() {
      var script = document.currentScript;
      if (!script) return;
      var root = script.parentElement;
      if (!root || root.getAttribute('data-cmp-id') !== 'phy.apparatus.pulley-movable.interactive') return;
  
      var svg = root.querySelector('svg');
      if (!svg) return;
  
      /* â”€â”€â”€ å‚æ•° â”€â”€â”€ */
      var P = {};
      try {
        var raw = root.getAttribute('data-props');
        if (raw) { var o = JSON.parse(raw); if (o && typeof o === 'object') P = o; }
      } catch(e) {}
  
      var loadMass = Math.max(0, Number(P.loadMass) || 200);
      var massUnit = (P.unit === 'kg') ? 'kg' : 'g';
  
      /* â”€â”€â”€ å‡ ä½•å¸¸é‡ â”€â”€â”€ */
      /*
       * æ•™ç§‘ä¹¦æ ‡å‡†ç”»æ³•ï¼š
       *
       *   å¤©èŠ±æ¿ â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       *   â”ƒ(å›ºå®š)          â”ƒ â†‘F
       *   â”ƒ                â”ƒ
       *   â”ƒ    â”Œâ”€â”€è½®â”€â”€â”    â”ƒ
       *   â”—â”â”â”â”â”¤  â—   â”œâ”â”â”â”â”›
       *        â””â”€â”€â”¬â”€â”€â”˜
       *           â”‚æ¡†æ¶
       *          ğŸªğŸª
       *        â”Œâ”€â”€â”€â”€â”€â”
       *        â”‚200 gâ”‚
       *        â””â”€â”€â”€â”€â”€â”˜
       *
       *   å·¦ç»³ç«–ç›´ï¼Œå³ç»³ç«–ç›´ï¼Œç»³ç»•æ»‘è½®åº•éƒ¨
       *   F = mg/2
       */
      var PULLEY_R = 26;
      var PCX = 100;                     /* æ»‘è½®ä¸­å¿ƒ x */
      var LX = PCX - PULLEY_R;           /* 74: å·¦ç»³ x */
      var RX = PCX + PULLEY_R;           /* 126: å³ç»³ x */
  
      var CEIL_Y = 12;                   /* å¤©èŠ±æ¿åº•è¾¹ y */
      var ANCHOR_Y = 20;                 /* å›ºå®šç‚¹/ç»³é¡¶ y */
      var PULLEY_MIN_CY = 62;           /* æ»‘è½®ä¸­å¿ƒæœ€é«˜ */
      var PULLEY_MAX_CY = 230;          /* æ»‘è½®ä¸­å¿ƒæœ€ä½ */
      var PULLEY_TRAVEL = PULLEY_MAX_CY - PULLEY_MIN_CY;
  
      /* ratio: 0 = æ»‘è½®æœ€ä½, 1 = æ»‘è½®æœ€é«˜ */
      var ratio = 0.15;
  
      /* â”€â”€â”€ DOM â”€â”€â”€ */
      var ropeLeft  = root.querySelector('.mpl__rope-left');
      var ropeArc   = root.querySelector('.mpl__rope-arc');
      var ropeRight = root.querySelector('.mpl__rope-right');
      var spokes    = root.querySelector('.mpl__spokes');
  
      var wheelOuter  = root.querySelector('.mpl__wheel-outer');
      var wheelGroove = root.querySelector('.mpl__wheel-groove');
      var axleOuter   = root.querySelector('.mpl__axle-outer');
      var axleInner   = root.querySelector('.mpl__axle-inner');
  
      var frameLeft   = root.querySelector('.mpl__frame-left');
      var frameRight  = root.querySelector('.mpl__frame-right');
      var frameBottom = root.querySelector('.mpl__frame-bottom');
      var frameRod    = root.querySelector('.mpl__frame-rod');
  
      var frameHook = root.querySelector('.mpl__frame-hook');
      var loadHook  = root.querySelector('.mpl__load-hook');
      var loadBlock = root.querySelector('.mpl__load-block');
      var massTxt   = root.querySelector('.mpl__mass-text');
  
      var pullLine  = root.querySelector('.mpl__pull-line');
      var pullArrow = root.querySelector('.mpl__pull-arrow');
      var hitRect   = root.querySelector('.mpl__hit');
      var forceTxt  = root.querySelector('.mpl__force-text');
  
      /* â”€â”€â”€ æ¸²æŸ“ â”€â”€â”€ */
      function render() {
        var pcy = PULLEY_MAX_CY - ratio * PULLEY_TRAVEL;
  
        /* â”€â”€ ç»³ç´¢ â”€â”€ */
        if (ropeLeft) {
          ropeLeft.setAttribute('x1', LX); ropeLeft.setAttribute('y1', ANCHOR_Y);
          ropeLeft.setAttribute('x2', LX); ropeLeft.setAttribute('y2', pcy);
        }
        if (ropeArc) {
          ropeArc.setAttribute('d',
            'M' + LX + ',' + pcy + ' A' + PULLEY_R + ',' + PULLEY_R + ' 0 1,0 ' + RX + ',' + pcy);
        }
        /* å³ç»³ï¼šä»æ»‘è½®å³åˆ‡ç‚¹ç«–ç›´å‘ä¸Šåˆ°å¤©èŠ±æ¿ */
        if (ropeRight) {
          ropeRight.setAttribute('x1', RX); ropeRight.setAttribute('y1', pcy);
          ropeRight.setAttribute('x2', RX); ropeRight.setAttribute('y2', CEIL_Y);
        }
  
        /* â”€â”€ æ»‘è½®ä½ç½® â”€â”€ */
        if (wheelOuter)  { wheelOuter.setAttribute('cx', PCX);  wheelOuter.setAttribute('cy', pcy); }
        if (wheelGroove) { wheelGroove.setAttribute('cx', PCX); wheelGroove.setAttribute('cy', pcy); }
        if (axleOuter)   { axleOuter.setAttribute('cx', PCX);   axleOuter.setAttribute('cy', pcy); }
        if (axleInner)   { axleInner.setAttribute('cx', PCX);   axleInner.setAttribute('cy', pcy); }
  
        /* è¾æ¡ */
        var spokeLines = spokes ? spokes.querySelectorAll('line') : [];
        if (spokeLines.length === 4) {
          var sr = PULLEY_R;
          var sd = sr * 0.707;
          spokeLines[0].setAttribute('x1', PCX);      spokeLines[0].setAttribute('y1', pcy - sr);
          spokeLines[0].setAttribute('x2', PCX);      spokeLines[0].setAttribute('y2', pcy + sr);
          spokeLines[1].setAttribute('x1', PCX - sr);  spokeLines[1].setAttribute('y1', pcy);
          spokeLines[1].setAttribute('x2', PCX + sr);  spokeLines[1].setAttribute('y2', pcy);
          spokeLines[2].setAttribute('x1', PCX - sd);  spokeLines[2].setAttribute('y1', pcy - sd);
          spokeLines[2].setAttribute('x2', PCX + sd);  spokeLines[2].setAttribute('y2', pcy + sd);
          spokeLines[3].setAttribute('x1', PCX + sd);  spokeLines[3].setAttribute('y1', pcy - sd);
          spokeLines[3].setAttribute('x2', PCX - sd);  spokeLines[3].setAttribute('y2', pcy + sd);
        }
        if (spokes) {
          var deg = ratio * 720;
          spokes.setAttribute('transform',
            'rotate(' + deg.toFixed(1) + ',' + PCX + ',' + pcy + ')');
        }
  
        /* â”€â”€ æ¡†æ¶ â”€â”€ */
        if (frameLeft) {
          frameLeft.setAttribute('x1', PCX - 12); frameLeft.setAttribute('y1', pcy);
          frameLeft.setAttribute('x2', PCX - 6);  frameLeft.setAttribute('y2', pcy + 24);
        }
        if (frameRight) {
          frameRight.setAttribute('x1', PCX + 12); frameRight.setAttribute('y1', pcy);
          frameRight.setAttribute('x2', PCX + 6);  frameRight.setAttribute('y2', pcy + 24);
        }
        if (frameBottom) {
          frameBottom.setAttribute('x1', PCX - 6); frameBottom.setAttribute('y1', pcy + 24);
          frameBottom.setAttribute('x2', PCX + 6); frameBottom.setAttribute('y2', pcy + 24);
        }
        if (frameRod) {
          frameRod.setAttribute('x1', PCX); frameRod.setAttribute('y1', pcy + 24);
          frameRod.setAttribute('x2', PCX); frameRod.setAttribute('y2', pcy + 32);
        }
  
        /* â”€â”€ åŒé’©å­ â”€â”€ */
        var hookBaseY = pcy + 32;
  
        if (frameHook) {
          var fhy = hookBaseY;
          frameHook.setAttribute('d',
            'M' + PCX + ',' + fhy +
            ' L' + PCX + ',' + (fhy + 4) +
            ' C' + PCX + ',' + (fhy + 14) +
            ' ' + (PCX - 16) + ',' + (fhy + 14) +
            ' ' + (PCX - 16) + ',' + (fhy + 4) +
            ' C' + (PCX - 16) + ',' + (fhy - 2) +
            ' ' + (PCX - 9) + ',' + (fhy - 1) +
            ' ' + (PCX - 8) + ',' + (fhy + 3));
        }
  
        var whY = hookBaseY + 14;
        if (loadHook) {
          loadHook.setAttribute('d',
            'M' + (PCX - 8) + ',' + (whY + 0) +
            ' C' + (PCX - 8) + ',' + (whY - 8) +
            ' ' + (PCX + 8) + ',' + (whY - 8) +
            ' ' + (PCX + 8) + ',' + (whY + 0) +
            ' C' + (PCX + 8) + ',' + (whY + 7) +
            ' ' + (PCX + 1) + ',' + (whY + 6) +
            ' ' + PCX + ',' + (whY + 10) +
            ' L' + PCX + ',' + (whY + 14));
        }
  
        var bx = PCX - 24;
        var by = whY + 14;
        if (loadBlock) {
          loadBlock.setAttribute('x', bx);
          loadBlock.setAttribute('y', by);
        }
        if (massTxt) {
          var mStr = (massUnit === 'kg')
            ? (Math.round(loadMass * 100) / 100) + ' kg'
            : Math.round(loadMass) + ' g';
          massTxt.textContent = mStr;
          massTxt.setAttribute('x', PCX);
          massTxt.setAttribute('y', by + 33);
        }
  
        /* â”€â”€ æ–½åŠ›æ ‡æ³¨ï¼ˆå³ç»³æ—è¾¹ï¼Œä¸é®æŒ¡ï¼‰ â”€â”€ */
        /*
         * åœ¨å³ç»³ä¸­éƒ¨åä¸Šçš„ä½ç½®ï¼Œç»˜åˆ¶ä¸€ä¸ªå‘ä¸Šçš„åŠ›ç®­å¤´
         * ç®­å¤´åœ¨å³ç»³å³ä¾§åç§» 12pxï¼Œä¸ä¸ç»³é‡å 
         */
        var arrowX = RX + 14;           /* ç®­å¤´ xï¼šåœ¨å³ç»³å³ä¾§åç§» */
        var arrowMidY = (CEIL_Y + pcy) / 2;  /* ç®­å¤´ä¸­éƒ¨ yï¼šå³ç»³ä¸­ç‚¹ */
        var arrowLen = 36;
  
        /* ç®­å¤´æœä¸Š */
        var arrowTipY = arrowMidY - arrowLen / 2;
        var arrowTailY = arrowMidY + arrowLen / 2;
  
        if (pullLine) {
          pullLine.setAttribute('x1', arrowX); pullLine.setAttribute('y1', arrowTipY + 10);
          pullLine.setAttribute('x2', arrowX); pullLine.setAttribute('y2', arrowTailY);
        }
        if (pullArrow) {
          pullArrow.setAttribute('points',
            (arrowX - 6) + ',' + (arrowTipY + 12) + ' ' +
            arrowX + ',' + arrowTipY + ' ' +
            (arrowX + 6) + ',' + (arrowTipY + 12));
        }
  
        /* åŠ›å€¼æ–‡å­—ï¼ˆç®­å¤´å³ä¾§ï¼‰ */
        var massKg = (massUnit === 'kg') ? loadMass : loadMass / 1000;
        var force = massKg * 9.8 / 2;
        if (forceTxt) {
          forceTxt.textContent = 'F=' + force.toFixed(2) + ' N';
          forceTxt.setAttribute('x', arrowX + 10);
          forceTxt.setAttribute('y', arrowMidY + 4);
        }
  
        /* æ‹–æ‹½çƒ­åŒºï¼ˆè¦†ç›–å³ç»³æ•´æ®µï¼‰ */
        if (hitRect) {
          hitRect.setAttribute('x', RX - 15);
          hitRect.setAttribute('y', CEIL_Y);
          hitRect.setAttribute('width', 55);
          hitRect.setAttribute('height', pcy - CEIL_Y);
        }
  
        root.setAttribute('aria-label',
          'åŠ¨æ»‘è½®ï¼ˆäº¤äº’å¼ï¼‰ï¼Œè´Ÿè½½ ' + Math.round(loadMass) + ' ' + massUnit +
          'ï¼Œæ–½åŠ› ' + force.toFixed(2) + ' Nï¼ˆçœä¸€åŠåŠ›ï¼‰');
      }
  
      function emitPulley(name) {
        var massKg_ = (massUnit === 'kg') ? loadMass : loadMass / 1000;
        var force_ = massKg_ * 9.8 / 2;
        root.dispatchEvent(new CustomEvent(name, {
          bubbles: true, composed: true,
          detail: { id: root.getAttribute('data-cmp-id'), type: 'adjust', values: { ratio: Math.round(ratio * 100) / 100, force: Math.round(force_ * 100) / 100 } }
        }));
      }

      render();

      /* â”€â”€â”€ æ‹–æ‹½ â”€â”€â”€ */
      var dragging = false;
      var startClientY = 0, startRatio = 0;
  
      function onDown(e) {
        e.preventDefault();
        dragging = true;
        var pt = e.touches ? e.touches[0] : e;
        startClientY = pt.clientY;
        startRatio = ratio;
        document.addEventListener('mousemove', onMove, { passive: false });
        document.addEventListener('mouseup',   onUp);
        document.addEventListener('touchmove', onMove, { passive: false });
        document.addEventListener('touchend',  onUp);
      }
      function onMove(e) {
        if (!dragging) return;
        e.preventDefault();
        var pt = e.touches ? e.touches[0] : e;
        var rect = svg.getBoundingClientRect();
        var scale = rect.height / 380;
        var dy = (pt.clientY - startClientY) / scale;
        /* å‘ä¸Šæ‹–(dy<0) â†’ ratioå¢å¤§ â†’ æ»‘è½®ä¸Šå‡ */
        var newRatio = startRatio - dy / (PULLEY_TRAVEL * 2);
        ratio = Math.max(0, Math.min(1, newRatio));
        render();
        emitPulley('cmp:change');
      }
      function onUp() {
        dragging = false;
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup',   onUp);
        document.removeEventListener('touchmove', onMove);
        document.removeEventListener('touchend',  onUp);
        emitPulley('cmp:changeend');
      }
  
      var handle = root.querySelector('.mpl__handle');
      if (handle) {
        handle.addEventListener('mousedown',  onDown, { passive: false });
        handle.addEventListener('touchstart', onDown, { passive: false });
      }
    })();
    </script>
  </div>