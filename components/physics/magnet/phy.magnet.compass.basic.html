<!-- @cmp-manifest
{
  "schema": "cmp-manifest/v1",
  "id": "phy.magnet.compass.basic",
  "name": "小磁针",
  "nameEn": "Magnetic Compass Needle",
  "category": "physics/magnet",
  "version": "1.0.0",
  "viewport": { "w": 120, "h": 160 },
  "tags": ["magnet", "compass", "needle", "NS-pole", "magnetic-field"],
  "props": [
    { "key": "size",        "type": "number(px)", "default": 160, "min": 80, "max": 400, "desc": "组件高度" },
    { "key": "northColor",  "type": "color",  "default": "#e53935", "desc": "N极颜色" },
    { "key": "southColor",  "type": "color",  "default": "#1e88e5", "desc": "S极颜色" },
    { "key": "baseColor",   "type": "color",  "default": "#f5f5f5", "desc": "底座颜色" },
    { "key": "stroke",      "type": "color",  "default": "#333333", "desc": "描边颜色" },
    { "key": "strokeWidth", "type": "number", "default": 1.2, "min": 0.5, "max": 3, "desc": "描边粗细" },
    { "key": "angle",       "type": "number", "default": 0, "min": -180, "max": 180, "desc": "磁针旋转角度(°)" },
    { "key": "glow",        "type": "number(0-1)", "default": 0, "min": 0, "max": 1, "desc": "亮度" }
  ],
  "cssVars": {
    "size":        "--cmp-size",
    "northColor":  "--cmp-north",
    "southColor":  "--cmp-south",
    "baseColor":   "--cmp-base",
    "stroke":      "--cmp-stroke",
    "strokeWidth": "--cmp-stroke-width",
    "glow":        "--cmp-glow"
  }
}
-->
<div class="cmp" data-cmp-id="phy.magnet.compass.basic" role="img" aria-label="小磁针">
  <style>
    .cmp[data-cmp-id="phy.magnet.compass.basic"] {
      --h: var(--cmp-size, 160px);
      display: inline-block;
      width: calc(var(--h) * 120 / 160);
      height: var(--h);
      filter: drop-shadow(0 0 calc(6px * var(--cmp-glow, 0))
              rgba(255,214,102, calc(0.8 * var(--cmp-glow, 0))));
      user-select: none;
    }
    .cmp[data-cmp-id="phy.magnet.compass.basic"] svg {
      width: 100%; height: 100%; display: block; overflow: visible;
    }
    .cmp[data-cmp-id="phy.magnet.compass.basic"] .cn__label {
      font-family: Arial, sans-serif;
      font-weight: 700;
      pointer-events: none;
    }
  </style>

  <svg viewBox="0 0 120 160" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <defs>
      <!-- N极渐变 -->
      <linearGradient class="cn__n-grad" x1="0.5" y1="1" x2="0.5" y2="0">
        <stop offset="0" stop-color="var(--cmp-north, #e53935)" stop-opacity="0.7"/>
        <stop offset="0.4" stop-color="var(--cmp-north, #e53935)"/>
        <stop offset="1" stop-color="var(--cmp-north, #e53935)" stop-opacity="0.8"/>
      </linearGradient>
      <!-- S极渐变 -->
      <linearGradient class="cn__s-grad" x1="0.5" y1="0" x2="0.5" y2="1">
        <stop offset="0" stop-color="var(--cmp-south, #1e88e5)" stop-opacity="0.7"/>
        <stop offset="0.4" stop-color="var(--cmp-south, #1e88e5)"/>
        <stop offset="1" stop-color="var(--cmp-south, #1e88e5)" stop-opacity="0.8"/>
      </linearGradient>
      <!-- 底座渐变 -->
      <radialGradient class="cn__base-grad" cx="0.45" cy="0.4" r="0.6">
        <stop offset="0" stop-color="#fff" stop-opacity="0.4"/>
        <stop offset="0.5" stop-color="var(--cmp-base, #f5f5f5)"/>
        <stop offset="1" stop-color="var(--cmp-base, #f5f5f5)" stop-opacity="0.8"/>
      </radialGradient>
      <!-- 支柱金属渐变 -->
      <linearGradient class="cn__post-grad" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0" stop-color="#999"/>
        <stop offset="0.3" stop-color="#ddd"/>
        <stop offset="0.5" stop-color="#eee"/>
        <stop offset="0.7" stop-color="#ddd"/>
        <stop offset="1" stop-color="#999"/>
      </linearGradient>
    </defs>

    <!-- ===== 底座 ===== -->
    <!-- 底座椭圆（立体感） -->
    <ellipse cx="60" cy="142" rx="42" ry="12"
             fill="#ccc" opacity="0.3"/>
    <ellipse class="cn__base" cx="60" cy="138" rx="40" ry="11"
             stroke="var(--cmp-stroke, #333)" stroke-width="var(--cmp-stroke-width, 1.2)"/>
    <!-- 底座侧面 -->
    <path d="M20,138 L20,142 A40,11 0 0,0 100,142 L100,138"
          fill="var(--cmp-base, #f5f5f5)" opacity="0.6"
          stroke="var(--cmp-stroke, #333)" stroke-width="var(--cmp-stroke-width, 1.2)"/>
    <!-- 底座顶面高光 -->
    <ellipse cx="55" cy="136" rx="22" ry="5" fill="#fff" opacity="0.15"/>

    <!-- ===== 支柱 ===== -->
    <rect class="cn__post" x="57" y="82" width="6" height="56" rx="1.5"
          stroke="var(--cmp-stroke, #333)" stroke-width="0.8"/>
    <!-- 支柱顶部尖端（支撑磁针的针尖） -->
    <polygon points="60,74 57,82 63,82"
             fill="#bbb"
             stroke="var(--cmp-stroke, #333)" stroke-width="0.8"
             stroke-linejoin="round"/>

    <!-- ===== 磁针（可旋转，绕支柱尖端 60,74 旋转） ===== -->
    <g class="cn__needle-group">
      <!-- N极（上半，菱形尖端朝上） -->
      <polygon class="cn__n-half"
               points="60,30 52,74 60,78 68,74"
               stroke="var(--cmp-stroke, #333)" stroke-width="var(--cmp-stroke-width, 1.2)"
               stroke-linejoin="round"/>
      <!-- S极（下半，菱形尖端朝下） -->
      <polygon class="cn__s-half"
               points="60,118 68,74 60,70 52,74"
               stroke="var(--cmp-stroke, #333)" stroke-width="var(--cmp-stroke-width, 1.2)"
               stroke-linejoin="round"/>

      <!-- N极高光 -->
      <line x1="58" y1="42" x2="56" y2="66" stroke="#fff" stroke-width="1.2" opacity="0.25" stroke-linecap="round"/>
      <!-- S极高光 -->
      <line x1="58" y1="106" x2="56" y2="82" stroke="#fff" stroke-width="1.2" opacity="0.2" stroke-linecap="round"/>

      <!-- 中心轴孔 -->
      <circle cx="60" cy="74" r="3.5"
              fill="#ddd"
              stroke="var(--cmp-stroke, #333)" stroke-width="0.8"/>
      <circle cx="59" cy="73" r="1" fill="#fff" opacity="0.4"/>

      <!-- N / S 标签 -->
      <text class="cn__label" x="60" y="60" text-anchor="middle"
            font-size="10" fill="#fff" opacity="0.9">N</text>
      <text class="cn__label" x="60" y="94" text-anchor="middle"
            font-size="10" fill="#fff" opacity="0.9">S</text>
    </g>
  </svg>
</div>

<script>
(function() {
  var script = document.currentScript;
  if (!script) return;
  var root = script.previousElementSibling;
  if (!root || root.getAttribute('data-cmp-id') !== 'phy.magnet.compass.basic') return;
  var svg = root.querySelector('svg');
  if (!svg) return;

  /* ── 唯一 ID（多实例安全） ── */
  var uid = 'cn_' + Math.random().toString(36).slice(2, 8);

  var nGrad = svg.querySelector('.cn__n-grad');
  var sGrad = svg.querySelector('.cn__s-grad');
  var baseGrad = svg.querySelector('.cn__base-grad');
  var postGrad = svg.querySelector('.cn__post-grad');

  if (nGrad) nGrad.setAttribute('id', uid + '_ng');
  if (sGrad) sGrad.setAttribute('id', uid + '_sg');
  if (baseGrad) baseGrad.setAttribute('id', uid + '_bg');
  if (postGrad) postGrad.setAttribute('id', uid + '_pg');

  /* 填色绑定 */
  var nHalf = root.querySelector('.cn__n-half');
  var sHalf = root.querySelector('.cn__s-half');
  var baseEl = root.querySelector('.cn__base');
  var postEl = root.querySelector('.cn__post');

  if (nHalf) nHalf.setAttribute('fill', 'url(#' + uid + '_ng)');
  if (sHalf) sHalf.setAttribute('fill', 'url(#' + uid + '_sg)');
  if (baseEl) baseEl.setAttribute('fill', 'url(#' + uid + '_bg)');
  if (postEl) postEl.setAttribute('fill', 'url(#' + uid + '_pg)');

  /* ── Props ── */
  var P = {};
  try {
    var raw = root.getAttribute('data-props');
    if (raw) { var o = JSON.parse(raw); if (o && typeof o === 'object') P = o; }
  } catch(e) {}

  /* angle: 磁针旋转角度 */
  var needleG = root.querySelector('.cn__needle-group');
  if (needleG) {
    var angle = parseFloat(P.angle) || 0;
    if (angle !== 0) {
      needleG.setAttribute('transform', 'rotate(' + angle + ' 60 74)');
    }
  }
})();
</script>