<!-- @cmp-manifest
{
  "schema": "cmp-manifest/v1",
  "id": "phy.optics.lens.concave.basic",
  "name": "凹透镜",
  "nameEn": "Concave Lens",
  "category": "physics/optics",
  "version": "1.0.0",
  "viewport": { "w": 80, "h": 200 },
  "tags": ["optics", "lens", "concave-lens", "diverging", "refraction"],
  "props": [
    { "key": "size",        "type": "number(px)", "default": 200, "min": 100, "max": 400, "desc": "组件高度" },
    { "key": "lensColor",   "type": "color",  "default": "#90caf9", "desc": "透镜颜色" },
    { "key": "lensEdge",    "type": "color",  "default": "#42a5f5", "desc": "透镜边缘色" },
    { "key": "stroke",      "type": "color",  "default": "#333333", "desc": "描边颜色" },
    { "key": "strokeWidth", "type": "number", "default": 1.5, "min": 0.5, "max": 4, "desc": "描边粗细" },
    { "key": "showAxis",    "type": "boolean", "default": true, "desc": "显示主光轴" },
    { "key": "showArrows",  "type": "boolean", "default": true, "desc": "显示端部箭头" },
    { "key": "glow",        "type": "number(0-1)", "default": 0, "min": 0, "max": 1, "desc": "亮度" }
  ],
  "cssVars": {
    "size":        "--cmp-size",
    "lensColor":   "--cmp-lens",
    "lensEdge":    "--cmp-lens-edge",
    "stroke":      "--cmp-stroke",
    "strokeWidth": "--cmp-stroke-width",
    "glow":        "--cmp-glow"
  }
}
-->
<div class="cmp" data-cmp-id="phy.optics.lens.concave.basic" role="img" aria-label="凹透镜">
  <style>
    .cmp[data-cmp-id="phy.optics.lens.concave.basic"] {
      --h: var(--cmp-size, 200px);
      display: inline-block;
      width: calc(var(--h) * 80 / 200);
      height: var(--h);
      filter: drop-shadow(0 0 calc(6px * var(--cmp-glow, 0))
              rgba(255,214,102, calc(0.8 * var(--cmp-glow, 0))));
      user-select: none;
    }
    .cmp[data-cmp-id="phy.optics.lens.concave.basic"] svg {
      width: 100%; height: 100%; display: block; overflow: visible;
    }
  </style>

  <svg viewBox="0 0 80 200" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <defs>
      <!-- 透镜填充渐变（水平方向，边缘深中间浅） -->
      <linearGradient class="ccl__fill-grad" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0" stop-color="var(--cmp-lens-edge, #42a5f5)" stop-opacity="0.6"/>
        <stop offset="0.35" stop-color="var(--cmp-lens, #90caf9)" stop-opacity="0.25"/>
        <stop offset="0.5" stop-color="var(--cmp-lens, #90caf9)" stop-opacity="0.15"/>
        <stop offset="0.65" stop-color="var(--cmp-lens, #90caf9)" stop-opacity="0.25"/>
        <stop offset="1" stop-color="var(--cmp-lens-edge, #42a5f5)" stop-opacity="0.6"/>
      </linearGradient>
      <!-- 高光渐变（垂直方向） -->
      <linearGradient class="ccl__hl-grad" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0" stop-color="#fff" stop-opacity="0.3"/>
        <stop offset="0.3" stop-color="#fff" stop-opacity="0.08"/>
        <stop offset="0.7" stop-color="#fff" stop-opacity="0"/>
        <stop offset="1" stop-color="#fff" stop-opacity="0.1"/>
      </linearGradient>
    </defs>

    <!-- 主光轴（水平虚线） -->
    <line class="ccl__axis" x1="0" y1="100" x2="80" y2="100"
          stroke="#999" stroke-width="0.8" stroke-dasharray="4,3" opacity="0.5"/>

    <!--
      凹透镜形状：中间薄、边缘厚
      viewBox 80×200，透镜中心 (40, 100)
      外轮廓：左右两侧各一条向内凹的弧线
      上下端面：水平直线（厚边缘）

      结构：
      - 上端面 y=18，宽度 22~58（厚36px）
      - 下端面 y=182，宽度 22~58（厚36px）
      - 中腰 y=100，宽度 32~48（薄16px）
      - 左侧轮廓：从(22,18)向内凹到(32,100)再到(22,182)
      - 右侧轮廓：从(58,18)向内凹到(48,100)再到(58,182)
    -->

    <!-- 透镜主体 -->
    <path class="ccl__body"
          d="M22,18 L58,18
             Q48,55 48,100 Q48,145 58,182
             L22,182
             Q32,145 32,100 Q32,55 22,18 Z"
          stroke="var(--cmp-lens-edge, #42a5f5)"
          stroke-width="var(--cmp-stroke-width, 1.5)"
          stroke-linejoin="round"/>

    <!-- 高光层 -->
    <path class="ccl__highlight"
          d="M22,18 L58,18
             Q48,55 48,100 Q48,145 58,182
             L22,182
             Q32,145 32,100 Q32,55 22,18 Z"
          fill="none" opacity="0.5"/>

    <!-- 上端面厚度强调线 -->
    <line x1="22" y1="18" x2="58" y2="18"
          stroke="var(--cmp-lens-edge, #42a5f5)" stroke-width="2" stroke-linecap="round" opacity="0.6"/>
    <!-- 下端面厚度强调线 -->
    <line x1="22" y1="182" x2="58" y2="182"
          stroke="var(--cmp-lens-edge, #42a5f5)" stroke-width="2" stroke-linecap="round" opacity="0.6"/>

    <!-- 端部箭头标记（凹透镜符号：箭头向内） -->
    <g class="ccl__arrows">
      <!-- 上端：左右各一个向内的箭头 -->
      <polygon points="18,10 22,18 26,10" fill="var(--cmp-lens-edge, #42a5f5)" opacity="0.8"/>
      <polygon points="54,10 58,18 62,10" fill="var(--cmp-lens-edge, #42a5f5)" opacity="0.8"/>
      <!-- 下端：左右各一个向内的箭头 -->
      <polygon points="18,190 22,182 26,190" fill="var(--cmp-lens-edge, #42a5f5)" opacity="0.8"/>
      <polygon points="54,190 58,182 62,190" fill="var(--cmp-lens-edge, #42a5f5)" opacity="0.8"/>
    </g>

    <!-- 边缘高光线（左侧内弧） -->
    <path d="M25,24 Q33,55 33,100 Q33,145 25,176"
          fill="none" stroke="#fff" stroke-width="1" opacity="0.2" stroke-linecap="round"/>
  </svg>
</div>

<script>
(function() {
  var script = document.currentScript;
  if (!script) return;
  var root = script.previousElementSibling;
  if (!root || root.getAttribute('data-cmp-id') !== 'phy.optics.lens.concave.basic') return;
  var svg = root.querySelector('svg');
  if (!svg) return;

  /* ── 唯一 ID（多实例安全） ── */
  var uid = 'ccl_' + Math.random().toString(36).slice(2, 8);

  var fillGrad = svg.querySelector('.ccl__fill-grad');
  var hlGrad = svg.querySelector('.ccl__hl-grad');
  if (fillGrad) fillGrad.setAttribute('id', uid + '_fg');
  if (hlGrad) hlGrad.setAttribute('id', uid + '_hg');

  var body = root.querySelector('.ccl__body');
  var highlight = root.querySelector('.ccl__highlight');
  if (body) body.setAttribute('fill', 'url(#' + uid + '_fg)');
  if (highlight) highlight.setAttribute('fill', 'url(#' + uid + '_hg)');

  /* ── Props ── */
  var P = {};
  try {
    var raw = root.getAttribute('data-props');
    if (raw) { var o = JSON.parse(raw); if (o && typeof o === 'object') P = o; }
  } catch(e) {}

  /* showAxis */
  var axis = root.querySelector('.ccl__axis');
  if (axis && (P.showAxis === false || P.showAxis === 'false')) {
    axis.setAttribute('display', 'none');
  }

  /* showArrows */
  var arrows = root.querySelector('.ccl__arrows');
  if (arrows && (P.showArrows === false || P.showArrows === 'false')) {
    arrows.setAttribute('display', 'none');
  }
})();
</script>